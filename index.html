<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cerium | The Athletic Standard for Roblox Sports</title>

    <!-- Fonts and Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        :root {
            --color-background: #050505;
            --color-heading: #FFFFFF;
            --color-text: #E0E0E0;
            --color-text-muted: #a0a0a0;
            --color-card-bg: rgba(18, 18, 18, 0.7);
            --color-card-border: rgba(255, 255, 255, 0.1);
            --color-card-border-hover: rgba(255, 255, 255, 0.3);
            --primary-gradient: linear-gradient(90deg, #FFFFFF, #CCCCCC);
            --color-glow: rgba(255, 255, 255, 0.1);
            --color-status-up: #00FF7F;
            --color-status-down: #FF3366;
            --header-height: 80px;
            --font-family: 'Inter', sans-serif;
            --border-radius: 16px;
            --transition-speed: 0.4s;
            --transition-curve: cubic-bezier(0.16, 1, 0.3, 1);
        }

        /* --- Base & Animations --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; scroll-padding-top: var(--header-height); }
        body {
            font-family: var(--font-family); background-color: var(--color-background); color: var(--color-text);
            line-height: 1.7; overflow-x: hidden;
            background-image:
                radial-gradient(at 10% 20%, hsla(210, 80%, 40%, 0.1) 0px, transparent 50%),
                radial-gradient(at 85% 30%, hsla(280, 70%, 50%, 0.1) 0px, transparent 50%),
                radial-gradient(at 20% 80%, hsla(180, 75%, 45%, 0.1) 0px, transparent 50%);
            position: relative;
        }
        body.no-scroll { overflow: hidden; }

        @keyframes preloader-pulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.8; } }
        @keyframes reveal-up { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slide-up-and-fade-out { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-50px); } }
        @keyframes modal-fade-in { from { opacity: 0; transform: translateY(-20px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }

        /* --- Page State Management --- */
        #preloader, #login-wall, #welcome-transition { display: flex; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; background-color: var(--color-background); transition: opacity 0.5s ease, visibility 0.5s ease; }
        #login-wall, #welcome-transition, #main-content { opacity: 0; visibility: hidden; }
        body.state-preloading #preloader { opacity: 1; visibility: visible; }
        body.state-login #login-wall { opacity: 1; visibility: visible; animation: fade-in 0.5s ease forwards; }
        body.state-welcome #welcome-transition { opacity: 1; visibility: visible; animation: fade-in 0.5s ease forwards; }
        body.state-authenticated #main-content { opacity: 1; visibility: visible; animation: fade-in 0.5s ease forwards; }
        #preloader.hidden { opacity: 0; visibility: hidden; pointer-events: none; }

        #preloader .preloader-logo { font-size: 2.5rem; font-weight: 800; animation: preloader-pulse 2s infinite ease-in-out; }
        #login-wall .login-container { text-align: center; max-width: 500px; padding: 20px; }
        #login-wall .login-card { padding: 50px 60px; animation: reveal-up 1s var(--transition-curve) 0.3s forwards; opacity: 0; }
        #discord-login-btn { font-size: 1.1rem; padding: 16px 36px; }
        #welcome-transition.exiting { animation: slide-up-and-fade-out 0.8s var(--transition-curve) forwards; }
        .welcome-message h2 { font-size: 3rem; color: var(--color-heading); }
        .welcome-message .username { background: var(--primary-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }

        /* --- General UI Components --- */
        .btn { position: relative; display: inline-block; padding: 14px 32px; border-radius: 50px; text-decoration: none; font-weight: 600; border: 1px solid var(--color-card-border); cursor: pointer; transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .btn-primary { background-image: var(--primary-gradient); color: #000; border-color: transparent; }
        .btn-primary:hover { transform: scale(1.05); box-shadow: 0 5px 20px -5px var(--color-glow); }
        .btn-secondary { background-color: transparent; color: var(--color-heading); }
        .btn-secondary:hover { background-color: rgba(255,255,255,0.1); border-color: var(--color-card-border-hover); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; box-shadow: none !important; }

        .content-section { padding: 140px 5%; max-width: 1280px; margin: 0 auto; text-align: center; }
        .section-title { font-size: clamp(2.5rem, 5vw, 3.5rem); font-weight: 800; color: var(--color-heading); margin-bottom: 20px; }
        .section-subtitle { font-size: 1.1rem; max-width: 700px; margin: 0 auto 80px auto; color: var(--color-text-muted); }
        .gradient-text { background: var(--primary-gradient); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
        .card { background: var(--color-card-bg); backdrop-filter: blur(10px); border-radius: var(--border-radius); padding: 40px; border: 1px solid var(--color-card-border); }
        .revealable { opacity: 0; transform: translateY(40px); transition: opacity 0.8s var(--transition-curve), transform 0.8s var(--transition-curve); }
        .revealable.is-visible { opacity: 1; transform: translateY(0); }
        
        /* --- Header & Navigation --- */
        .main-header { position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; height: var(--header-height); display: flex; align-items: center; transition: background-color 0.3s ease, border-bottom-color 0.3s ease; border-bottom: 1px solid transparent; }
        .main-header.scrolled { background: rgba(5, 5, 5, 0.8); backdrop-filter: blur(12px); border-bottom-color: var(--color-card-border); }
        .navbar { display: flex; justify-content: space-between; align-items: center; width: 100%; max-width: 1400px; margin: 0 auto; padding: 0 5%; }
        .nav-left { display: flex; align-items: center; gap: 60px; }
        .nav-logo { font-size: 1.8rem; font-weight: 800; color: var(--color-heading); text-decoration: none; }
        .nav-menu { list-style: none; display: flex; gap: 45px; }
        .nav-link { color: var(--color-text-muted); text-decoration: none; font-weight: 600; transition: color 0.3s; }
        .nav-link:hover { color: var(--color-heading); }
        .nav-actions { display: flex; align-items: center; gap: 25px; }
        .user-info-details { display: flex; align-items: center; gap: 15px; cursor: pointer; padding: 5px; border-radius: 50px; transition: background-color 0.3s; }
        .user-info-details:hover { background-color: var(--color-card-bg); }
        .user-avatar { width: 40px; height: 40px; border-radius: 50%; }
        .user-name { font-weight: 600; color: var(--color-heading); }

        /* --- Hero Section --- */
        .hero-section { min-height: 100vh; display: flex; align-items: center; justify-content: center; text-align: center; position: relative; overflow: hidden; }
        .hero-section::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(600px circle at var(--mouse-x) var(--mouse-y), rgba(255, 255, 255, 0.06), transparent 80%); z-index: -1; transition: background 0.2s; }
        .hero-title { font-size: clamp(3rem, 7vw, 5.5rem); font-weight: 900; letter-spacing: -0.04em; }
        .hero-subtitle { font-size: 1.25rem; max-width: 650px; margin: 40px auto; color: var(--color-text-muted); }
        .hero-buttons { display: flex; justify-content: center; gap: 20px; }

        /* --- Team Section --- */
        #team-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-top: 60px; }
        .team-card { background: var(--color-card-bg); border-radius: var(--border-radius); padding: 30px; text-align: center; border: 1px solid var(--color-card-border); transition: all 0.3s ease; }
        .team-card:hover { transform: translateY(-8px); border-color: var(--color-card-border-hover); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .team-avatar-container { position: relative; margin: 0 auto 20px auto; width: 120px; height: 120px; }
        .team-avatar { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
        .team-card.owner .team-avatar { border: 3px solid #FFD700; box-shadow: 0 0 25px rgba(255, 215, 0, 0.5); }
        .team-name { font-size: 1.5rem; font-weight: 700; color: var(--color-heading); margin-bottom: 5px; }
        .team-title { font-weight: 600; font-size: 1rem; color: var(--color-text-muted); }
        .team-socials { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        .team-socials a { color: var(--color-text-muted); font-size: 1.2rem; transition: color 0.3s; }
        .team-socials a:hover { color: var(--color-heading); }

        /* --- Forms --- */
        #bug-report-form { max-width: 700px; margin: 40px auto 0; text-align: left; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 8px; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 14px 18px; border-radius: 8px; border: 1px solid var(--color-card-border); background: var(--color-card-bg); color: var(--color-text); font-size: 1rem; transition: all 0.3s; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { border-color: var(--color-card-border-hover); box-shadow: 0 0 15px var(--color-glow); outline: none; }
        .form-group textarea { resize: vertical; min-height: 120px; }
        #form-status-message { margin-top: 20px; text-align: center; min-height: 1.2em; font-weight: 600; }
        #form-status-message.success { color: var(--color-status-up); }
        #form-status-message.error { color: var(--color-status-down); }

        /* --- Profile Modal --- */
        #profile-modal { display: none; position: fixed; z-index: 10001; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); backdrop-filter: blur(8px); }
        #profile-modal.visible { display: flex; align-items: center; justify-content: center; animation: fade-in 0.3s ease; }
        .profile-modal-content { background: var(--color-background); border: 1px solid var(--color-card-border); padding: 40px; border-radius: var(--border-radius); max-width: 800px; width: 90%; position: relative; animation: modal-fade-in 0.5s var(--transition-curve); }
        .profile-modal-close { position: absolute; top: 15px; right: 25px; cursor: pointer; background: none; border: none; font-size: 28px; color: var(--color-text-muted); transition: color 0.3s, transform 0.3s; }
        .profile-modal-close:hover { color: var(--color-heading); transform: rotate(90deg); }
        .profile-header { display: flex; align-items: center; gap: 20px; margin-bottom: 30px; }
        #profile-modal-avatar { width: 80px; height: 80px; border-radius: 50%; }
        #profile-modal-username { font-size: 2rem; font-weight: 700; color: var(--color-heading); }
        .profile-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 1px solid var(--color-card-border); }
        .stat-item h4 { font-size: 0.9rem; opacity: 0.7; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-item p { font-size: 1.2rem; font-weight: 600; color: var(--color-heading); }
        #achievements-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .achievement-card { background: var(--color-card-bg); padding: 20px; border-radius: 12px; text-align: center; border: 1px solid var(--color-card-border); transition: all 0.3s; }
        .achievement-card.locked { opacity: 0.4; filter: grayscale(80%); }
        .achievement-card .icon { font-size: 2.5rem; margin-bottom: 15px; color: var(--color-heading); }
        
        /* --- Mobile Navigation --- */
        .mobile-nav-toggle { display: none; z-index: 10001; }
        #mobile-menu { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--color-background); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 40px; transform: translateY(-100%); transition: transform 0.5s var(--transition-curve); }
        body.mobile-nav-active #mobile-menu { transform: translateY(0); }
        #mobile-menu .nav-link { font-size: 2rem; font-weight: 700; }
        #mobile-menu .btn { margin-top: 20px; }

        @media (max-width: 768px) {
            .nav-left .nav-menu, .nav-actions { display: none; }
            .mobile-nav-toggle { display: flex; flex-direction: column; justify-content: space-around; width: 30px; height: 24px; background: transparent; border: none; cursor: pointer; padding: 0; }
            .mobile-nav-toggle .bar { width: 30px; height: 3px; background-color: var(--color-heading); border-radius: 10px; transition: all 0.3s ease-in-out; }
            body.mobile-nav-active .mobile-nav-toggle .bar:nth-child(1) { transform: rotate(45deg) translate(7px, 7px); }
            body.mobile-nav-active .mobile-nav-toggle .bar:nth-child(2) { opacity: 0; }
            body.mobile-nav-active .mobile-nav-toggle .bar:nth-child(3) { transform: rotate(-45deg) translate(7px, -7px); }
            .hero-section { --mouse-x: -1000px; --mouse-y: -1000px; /* Disable mouse effect on mobile */ }
        }
    </style>
</head>
<body class="state-preloading">

    <div id="preloader"><span class="preloader-logo gradient-text">Cerium</span></div>
    
    <div id="login-wall">
        <div class="login-card card">
            <h1 class="gradient-text" style="font-size: 3rem; margin-bottom: 10px;">Cerium</h1>
            <p class="section-subtitle" style="margin-bottom: 40px;">Please connect with Discord to access the Cerium Hub.</p>
            <div id="login-status-message"></div>
            <button id="discord-login-btn" class="btn btn-primary"><i class="fab fa-discord"></i> Connect with Discord</button>
        </div>
    </div>
    
    <div id="welcome-transition">
        <div class="welcome-message">
            <h2>Welcome, <span id="welcome-username" class="username"></span></h2>
        </div>
    </div>

    <div id="profile-modal" role="dialog" aria-modal="true" aria-labelledby="profile-modal-username">
        <div class="profile-modal-content">
            <button class="profile-modal-close" aria-label="Close profile modal">×</button>
            <div class="profile-header">
                <img src="" alt="User Avatar" id="profile-modal-avatar">
                <h3 id="profile-modal-username"></h3>
            </div>
            <div class="profile-stats">
                <div class="stat-item"><h4>Member Since</h4><p id="profile-modal-join-date"></p></div>
                <div class="stat-item"><h4>Reports Submitted</h4><p id="profile-modal-report-count"></p></div>
                <div class="stat-item"><h4>Comments Posted</h4><p id="profile-modal-comment-count"></p></div>
            </div>
            <h3 style="text-align: left; margin-bottom: 20px;">Achievements</h3>
            <div id="achievements-grid"></div>
        </div>
    </div>

    <!-- Mobile Navigation Menu -->
    <div id="mobile-menu">
        <a href="games.html" class="nav-link">Games</a>
        <a href="#team" class="nav-link">Team</a>
        <a href="#bug-report" class="nav-link">Report a Bug</a>
        <a href="https://discord.gg/qjsGU83urz" target="_blank" class="btn btn-secondary">Join Discord</a>
    </div>

    <div id="main-content">
        <header class="main-header">
            <nav class="navbar">
                <div class="nav-left">
                    <a href="#welcome" class="nav-logo gradient-text">Cerium</a>
                     <ul class="nav-menu">
                        <li><a href="games.html" class="nav-link">Games</a></li>
                        <li><a href="#team" class="nav-link">Team</a></li>
                        <li><a href="#bug-report" class="nav-link">Report</a></li>
                    </ul>
                </div>
                <div class="nav-actions">
                    <div id="header-user-info" class="user-info-details">
                        <img src="" alt="User Avatar" id="nav-user-avatar" class="user-avatar">
                        <span id="nav-user-name" class="user-name"></span>
                    </div>
                </div>
                <button class="mobile-nav-toggle" aria-label="Toggle Menu" aria-expanded="false">
                    <span class="bar"></span><span class="bar"></span><span class="bar"></span>
                </button>
            </nav>
        </header>

        <main>
            <section id="welcome" class="hero-section">
                <div class="revealable">
                    <h1 class="hero-title">The "Athletic" <span class="gradient-text">Standard</span></h1>
                    <p class="hero-subtitle">Engineered for victory across Roblox's top competitive sports games, giving you the ultimate edge.</p>
                    <div class="hero-buttons">
                        <a href="games.html" class="btn btn-primary">Explore Products</a>
                        <a href="#team" class="btn btn-secondary">Meet the Team</a>
                    </div>
                </div>
            </section>

            <section id="team" class="content-section revealable">
                <h2 class="section-title">Meet the <span class="gradient-text">Team</span></h2>
                <p class="section-subtitle">The minds behind the operation. We're dedicated to delivering unparalleled quality and support.</p>
                <div id="team-grid">
                    <div class="team-card owner">
                        <div class="team-avatar-container">
                             <img src="https://cdn.discordapp.com/avatars/696045435974058074/c775a6c1298889a74442657d42d547f4.webp?size=1024" alt="op_eq's avatar" class="team-avatar">
                        </div>
                        <h3 class="team-name">op_eq</h3>
                        <p class="team-title">Owner & Lead Developer</p>
                        <div class="team-socials">
                             <a href="#" aria-label="Discord"><i class="fab fa-discord"></i></a>
                             <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        </div>
                    </div>
                    <!-- Add more team members here -->
                    <div class="team-card">
                        <div class="team-avatar-container">
                             <img src="https://cdn.discordapp.com/embed/avatars/1.png" alt="Staff Member avatar" class="team-avatar">
                        </div>
                        <h3 class="team-name">Staff Member</h3>
                        <p class="team-title">Support / Tester</p>
                         <div class="team-socials">
                             <a href="#" aria-label="Discord"><i class="fab fa-discord"></i></a>
                        </div>
                    </div>
                </div>
            </section>

            <section id="bug-report" class="content-section revealable">
                <h2 class="section-title">Report a <span class="gradient-text">Bug</span></h2>
                <p class="section-subtitle">Encountered an issue? Help us improve by submitting a detailed report. Every submission helps.</p>
                <form id="bug-report-form" class="card">
                    <div class="form-group">
                        <label for="game-select">Select Game</label>
                        <select id="game-select" name="game-select" required></select>
                    </div>
                    <div class="form-group">
                        <label for="bug-description">Bug Description</label>
                        <textarea id="bug-description" name="bug-description" placeholder="Please be as detailed as possible." required></textarea>
                    </div>
                    <div style="text-align: center;">
                        <button type="submit" id="submit-bug-report" class="btn btn-primary">Submit Report</button>
                        <p id="form-status-message"></p>
                    </div>
                </form>
            </section>

            <section id="cta-section" class="content-section revealable">
                <h2>Ready to Redefine Your Game?</h2>
                <p class="section-subtitle">Join our community of elite players for support, updates, and more.</p>
                <a href="https://discord.gg/qjsGU83urz" target="_blank" class="btn btn-primary">Join the Discord Server</a>
            </section>
        </main>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", function() {
        /**
         * Cerium Hub Main Page Logic
         * Handles authentication, UI, profile management, and more.
         */
        const CeriumHub = {
            config: {
                DISCORD_CLIENT_ID: "1397805094854197280",
                REDIRECT_URI: window.location.origin + window.location.pathname,
                ACHIEVEMENTS: {
                    'welcome': { name: 'Welcome', description: 'Logged in for the first time.', icon: 'fas fa-door-open', condition: () => true },
                    'first_report': { name: 'Bug Squasher', description: 'Submitted your first report.', icon: 'fas fa-bug', condition: (p) => p.reportCount >= 1 },
                    'first_comment': { name: 'Voice of the Community', description: 'Posted your first comment in a discussion.', icon: 'fas fa-comments', condition: (p) => p.commentCount >= 1 },
                }
            },
            
            state: {
                currentUser: null,
            },
            
            elements: {
                body: document.body,
                preloader: document.getElementById('preloader'),
                discordLoginBtn: document.getElementById('discord-login-btn'),
                header: document.querySelector('.main-header'),
                heroSection: document.querySelector('.hero-section'),
                profileModal: document.getElementById('profile-modal'),
                mobileNavToggle: document.querySelector('.mobile-nav-toggle'),
                mobileMenu: document.getElementById('mobile-menu'),
                bugReportForm: document.getElementById('bug-report-form'),
                headerUserInfo: document.getElementById('header-user-info'),
                profileModalCloseBtn: document.querySelector('.profile-modal-close'),
            },

            // --- Main Initialization ---
            init() {
                this.events.bindCoreListeners();
                this.auth.handleOAuthCallback();
                this.ui.initScrollAnimations();
            },
            
            // --- Event Handling ---
            events: {
                bindCoreListeners() {
                    const { elements } = CeriumHub;
                    elements.discordLoginBtn.addEventListener('click', CeriumHub.auth.redirectToDiscord);
                    window.addEventListener('scroll', this.handleScroll);
                },
                bindAuthenticatedListeners() {
                    const { elements } = CeriumHub;
                    elements.headerUserInfo.addEventListener('click', CeriumHub.ui.displayProfileModal);
                    elements.profileModalCloseBtn.addEventListener('click', CeriumHub.ui.closeProfileModal);
                    elements.mobileNavToggle.addEventListener('click', CeriumHub.ui.toggleMobileNav);
                    elements.heroSection?.addEventListener('mousemove', this.handleHeroMouseMove);
                    
                    if(elements.bugReportForm) {
                        elements.bugReportForm.addEventListener('submit', this.handleBugReportSubmit);
                    }
                    // Close mobile menu when a link is clicked
                    elements.mobileMenu.querySelectorAll('.nav-link').forEach(link => {
                        link.addEventListener('click', () => CeriumHub.ui.toggleMobileNav(false));
                    });
                },
                handleScroll() {
                    CeriumHub.elements.header.classList.toggle('scrolled', window.scrollY > 50);
                },
                handleHeroMouseMove(e) {
                    CeriumHub.elements.heroSection.style.setProperty('--mouse-x', e.clientX + 'px');
                    CeriumHub.elements.heroSection.style.setProperty('--mouse-y', e.clientY + 'px');
                },
                async handleBugReportSubmit(event) {
                    event.preventDefault();
                    const form = CeriumHub.elements.bugReportForm;
                    const submitButton = form.querySelector('#submit-bug-report');
                    const statusMessage = form.querySelector('#form-status-message');
                    const user = CeriumHub.state.currentUser;
                    
                    submitButton.disabled = true;
                    submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
                    statusMessage.textContent = '';
                    statusMessage.className = '';

                    const discordPayload = {
                        username: "Cerium Bug Reports",
                        embeds: [{
                            author: { name: `${user.username} (${user.id})`, icon_url: user.avatar ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png` : 'https://cdn.discordapp.com/embed/avatars/0.png' },
                            fields: [
                                { name: "Game", value: form['game-select'].value },
                                { name: "Description", value: "```" + form['bug-description'].value.substring(0, 1020) + "```" }
                            ],
                            timestamp: new Date().toISOString()
                        }]
                    };

                    try {
                        const response = await fetch('/api/bug-reports', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ discordPayload })
                        });
                        if (!response.ok) throw new Error((await response.json()).error || 'Submission failed.');
                        
                        statusMessage.textContent = 'Report submitted successfully!';
                        statusMessage.className = 'success';
                        form.reset();
                        
                        CeriumHub.profile.updateStat('reportCount');
                    } catch (error) {
                        statusMessage.textContent = `Error: ${error.message}`;
                        statusMessage.className = 'error';
                    } finally {
                        submitButton.disabled = false;
                        submitButton.innerHTML = 'Submit Report';
                    }
                }
            },
            
            // --- Authentication & Security ---
            auth: {
                redirectToDiscord() {
                    const { DISCORD_CLIENT_ID, REDIRECT_URI } = CeriumHub.config;
                    window.location.href = `https://discord.com/api/oauth2/authorize?client_id=${DISCORD_CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=identify`;
                },
                getCurrentUser: () => { try { return JSON.parse(localStorage.getItem('discord_user_v2')); } catch (e) { return null; } },
                async checkAndRedirect(user) {
                    try {
                        const response = await fetch(`/api/check-user-status?userId=${user.id}`);
                        const data = await response.json();
                        if (data.status === 'banned') {
                            window.location.href = `/banned.html?reason=${encodeURIComponent(data.reason || '')}`;
                            return false; 
                        }
                        if (data.status === 'suspended') {
                            window.location.href = `/suspended.html?expires=${encodeURIComponent(data.expires || '')}&reason=${encodeURIComponent(data.reason || '')}`;
                            return false;
                        }
                        return true;
                    } catch (error) {
                        console.error("Status check failed, allowing access as a fail-safe:", error);
                        return true; 
                    }
                },
                recordUserPresence(user) {
                    fetch('/api/record-login', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ user }) })
                    .catch(err => console.warn("Failed to record user presence:", err));
                },
                async handleOAuthCallback() {
                    const fragment = new URLSearchParams(window.location.hash.substring(1));
                    const accessToken = fragment.get('access_token');
                    const { ui } = CeriumHub;

                    if (accessToken) {
                        try {
                            const res = await fetch('https://discord.com/api/users/@me', { headers: { authorization: `Bearer ${accessToken}` } });
                            if (!res.ok) throw new Error("Failed to fetch Discord user");
                            const userData = await res.json();
                            localStorage.setItem('discord_user_v2', JSON.stringify(userData));
                            window.history.replaceState({}, document.title, window.location.pathname);
                            
                            if (!await this.checkAndRedirect(userData)) return; 
                            this.recordUserPresence(userData);
                            
                            await ui.showWelcomeTransition(userData);
                        } catch { ui.showLoginWall(); }
                    } else {
                        const storedUser = this.getCurrentUser();
                        if (storedUser) {
                            if (!await this.checkAndRedirect(storedUser)) return;
                            this.recordUserPresence(storedUser);
                            await ui.showMainContent(storedUser);
                        } else {
                            ui.showLoginWall();
                        }
                    }
                },
            },

            // --- Profile & Achievements ---
            profile: {
                getProfileKey: (id) => `cerium_user_profile_${id}`,
                getOrCreateProfile(userData) {
                    const profileKey = this.getProfileKey(userData.id);
                    let profile = JSON.parse(localStorage.getItem(profileKey));
                    if (!profile) {
                        profile = { discordId: userData.id, joinDate: new Date().toISOString(), reportCount: 0, commentCount: 0, unlockedAchievements: [] };
                        localStorage.setItem(profileKey, JSON.stringify(profile));
                        this.unlockAchievement(profile, 'welcome');
                    }
                    return profile;
                },
                unlockAchievement(profile, achievementId) {
                    if (profile.unlockedAchievements.includes(achievementId)) return;
                    profile.unlockedAchievements.push(achievementId);
                    localStorage.setItem(this.getProfileKey(profile.discordId), JSON.stringify(profile));
                },
                checkAndUnlockAchievements(profile) {
                    const { ACHIEVEMENTS } = CeriumHub.config;
                    Object.keys(ACHIEVEMENTS).forEach(id => {
                        if (!profile.unlockedAchievements.includes(id) && ACHIEVEMENTS[id].condition(profile)) {
                           this.unlockAchievement(profile, id);
                        }
                    });
                },
                updateStat(statName, amount = 1) {
                    const user = CeriumHub.auth.getCurrentUser();
                    if (!user) return;
                    const profile = this.getOrCreateProfile(user);
                    profile[statName] = (profile[statName] || 0) + amount;
                    localStorage.setItem(this.getProfileKey(user.id), JSON.stringify(profile));
                    this.checkAndUnlockAchievements(profile);
                }
            },

            // --- API Data Loading ---
            api: {
                async loadDataForForms() {
                    const gameSelect = document.getElementById('game-select');
                    if (!gameSelect) return;
                    try {
                        const response = await fetch('/api/games');
                        if (!response.ok) throw new Error('Server error');
                        const games = await response.json();
                        gameSelect.innerHTML = '<option value="" disabled selected>Choose a game...</option>';
                        games.forEach(game => {
                            if (game.is_published) {
                                gameSelect.insertAdjacentHTML('beforeend', `<option value="${game.name}">${game.name}</option>`);
                            }
                        });
                        gameSelect.insertAdjacentHTML('beforeend', `<option value="Other">Other/Website</option>`);
                    } catch (error) { 
                        gameSelect.innerHTML = `<option value="" disabled selected>Could not load games</option>`;
                    }
                }
            },
            
            // --- UI/DOM Manipulation ---
            ui: {
                setPageState: (state) => CeriumHub.elements.body.className = `state-${state}`,
                showLoginWall() {
                    CeriumHub.elements.preloader.classList.add('hidden');
                    this.setPageState('login');
                },
                async showWelcomeTransition(userData) {
                    document.getElementById('welcome-username').textContent = userData.username;
                    CeriumHub.elements.preloader.classList.add('hidden');
                    this.setPageState('welcome');
                    await CeriumHub.api.loadDataForForms();
                    setTimeout(() => {
                        document.getElementById('welcome-transition').classList.add('exiting');
                        setTimeout(() => this.showMainContent(userData), 800);
                    }, 2000);
                },
                async showMainContent(userData) {
                    CeriumHub.state.currentUser = userData;
                    const profile = CeriumHub.profile.getOrCreateProfile(userData);
                    CeriumHub.profile.checkAndUnlockAchievements(profile);
                    this.setPageState('authenticated');
                    this.initializePageUI(userData);
                    CeriumHub.events.bindAuthenticatedListeners();
                    await CeriumHub.api.loadDataForForms();
                },
                initializePageUI(userData) {
                    document.getElementById('nav-user-avatar').src = `https://cdn.discordapp.com/avatars/${userData.id}/${userData.avatar}.png`;
                    document.getElementById('nav-user-name').textContent = userData.username;
                },
                displayProfileModal() {
                    const userData = CeriumHub.auth.getCurrentUser();
                    if (!userData) return;
                    const profile = CeriumHub.profile.getOrCreateProfile(userData);
                    document.getElementById('profile-modal-avatar').src = `https://cdn.discordapp.com/avatars/${userData.id}/${userData.avatar}.png`;
                    document.getElementById('profile-modal-username').textContent = `${userData.username}`;
                    document.getElementById('profile-modal-join-date').textContent = new Date(profile.joinDate).toLocaleDateString();
                    document.getElementById('profile-modal-report-count').textContent = profile.reportCount;
                    document.getElementById('profile-modal-comment-count').textContent = profile.commentCount || 0;
                    
                    const grid = document.getElementById('achievements-grid');
                    grid.innerHTML = '';
                    Object.keys(CeriumHub.config.ACHIEVEMENTS).forEach(id => {
                        const ach = CeriumHub.config.ACHIEVEMENTS[id];
                        const isUnlocked = profile.unlockedAchievements.includes(id);
                        grid.insertAdjacentHTML('beforeend', `<div class="achievement-card ${isUnlocked ? '' : 'locked'}" title="${ach.description}"><i class="${ach.icon} icon"></i><h5>${ach.name}</h5></div>`);
                    });
                    
                    CeriumHub.elements.profileModal.classList.add('visible');
                    CeriumHub.elements.body.classList.add('no-scroll');
                },
                closeProfileModal() {
                    CeriumHub.elements.profileModal.classList.remove('visible');
                    CeriumHub.elements.body.classList.remove('no-scroll');
                },
                toggleMobileNav(forceState) {
                    const isActive = CeriumHub.elements.body.classList.contains('mobile-nav-active');
                    const newState = typeof forceState === 'boolean' ? forceState : !isActive;
                    CeriumHub.elements.body.classList.toggle('mobile-nav-active', newState);
                    CeriumHub.elements.mobileNavToggle.setAttribute('aria-expanded', newState);
                },
                initScrollAnimations() {
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.classList.add('is-visible');
                                observer.unobserve(entry.target);
                            }
                        });
                    }, { threshold: 0.1 });
                    document.querySelectorAll('.revealable').forEach(el => observer.observe(el));
                }
            }
        };

        // --- Let's Go! ---
        CeriumHub.init();
    });
    </script>
</body>
</html>